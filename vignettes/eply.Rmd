---
title: "eply"
author: "William Michael Landau"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# Function `eply()`

```{r}
library(eply)
```

`eply()` applies a function over a data frame of expressions.

Begin with a function.
```{r}
.fun = example.fun
.fun
```

Then, make a data frame of expressions that return arguments to `.fun`.
```{r}
.expr = example.expr()
.expr
# str(.expr) # The expressions are actually just characters.
```

Those expressions need data.

```{r}
.with = example.with()
str(.with)
```

For each row in `.expr`, evaluate the expressions and feed the results to `.fun`.

```{r}
eply(.fun, .expr, .with)
```

You can discard `.with` if your data are in a clean global environment.

```{r}
a = 1
b = 2
eply(.fun, .expr)
```

# Function `meval()`

`meval()` evaluates a character vector of expressions.

```{r}
meval(c("1+1", "2+2", "3+3"))
meval(c("subset(mtcars, cyl == a, mpg, TRUE)", "mtcars[1:2, 1:2]"), 
      .with = list(a = 4))
```

# Parallel execution

For Mac and Linux users, `parallel::mclapply()` can distribute the work over multiple parallel tasks behind the scenes.

```{r, eval = F}
eply(.fun = example.fun, .expr = example.expr(), .split = strings(y, rep), .tasks = 2)
meval(x, .tasks = 2)
```

In `eply()` above, `.expr` splits into multiple pieces, one for each unique combination of `y` and `rep`. These pieces are processed in parallel (in this case, 2 at a time). For `meval()`, expressions are divided equally among the available parallel tasks.

# Functions `quotes()` and `unquote()`

If you want some expressions to actually be strings, use `quotes()`.

```{r}
.expr = data.frame(
  string = quotes(c("a", "b")),
  variable = c("c", "d"))
.expr
.fun = function(string, variable) paste(string, variable)
.with = list(c = "C", d = "D")
eply(.fun, .expr, .with)
```

Undo with `unquote()`.

```{r}
.expr$string = unquote(.expr$string)
.expr
```

# Function `strings()`

Turn valid expressions into strings with `strings()`.

```{r}
data.frame(
  arg1 = strings(a + b, sqrt(x) - 2), 
  arg2 = 1:2)
```
